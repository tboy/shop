<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />

		<title></title>
		<link href="../css/mui.min.css" rel="stylesheet" />
		<script src="index.js" type="text/javascript"></script>
		<link href="../css/myStyle.css" rel="stylesheet" />
		<link href="../css/icons-extra.css" rel="stylesheet" />
	</head>
	<body>
		<div id="cnt" style="opacity:0;">
			<Navs titl="首页"></Navs>

			<div id="pullrefresh" class="mui-content mui-scroll-wrapper" @touchmove="moveHandel">
				<div class='list'>
					<Items v-for="item in list" :tap="goDetail" :item="item"></Items>
				</div>
				<template v-if="list.length==0">
					<div class=" mui-block mui-visibility">
						<div class="mui-pull">
							<div class="mui-pull-loading mui-icon mui-spinner mui-hidden"></div>
							<div class="mui-pull-caption mui-pull-caption-nomore">没有更多数据了</div>
						</div>
					</div>
				</template>
			</div>


			<div class="footer" style="z-index:999999;">
				<div style="width:100%;display:flex;flex-direction: row;justify-content: space-around;">
					<div class="bar baractive">
						<div class='mui-icon mui-icon-home-filled'></div>
						<div>首页</div>
					</div>
					<div class="bar" @touchend="gotobag">
						<div class='mui-icon-extra mui-icon-extra-cart'></div>
						<div>购物袋</div>
					</div>
					<div class="bar" @touchend="gotome">
						<div class="mui-icon mui-icon-contact"></div>
						<div>我的</div>
					</div>
				</div>
			</div>

		</div>
	</body>
</html>

<script>
	var app;

	function initData() {

		let list = [];

		for (var i = 0; i < 10; i++) {
			let item = {};
			item.id = i;
			item.img = 'https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=3750666341,463573211&fm=26&gp=0.jpg';

			if (i % 2 == 0) {
				item.img = 'https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=4090761004,2650025905&fm=26&gp=0.jpg'
			}
			item.title = '【暖心助农 免疫力卫士】 四川安岳黄柠檬大果...';
			item.price = '9.99';
			item.oPrice = '19.99';
			list.push(item)
		}

		app = new Vue({
			el: '#cnt',
			data: {
				list: list,
				currentPage: 1,
				isMove: false
			},
			mounted() {
				mui.init({
					pullRefresh: {
						container: '#pullrefresh',
						down: {
							style: 'circle',
							callback: pulldownRefresh
						},
						up: {
							auto: false,
							contentrefresh: '正在加载...',
							callback: pullupRefresh
						}
					}
				});
				document.getElementById("cnt").style.opacity = 1;
				this.search();
			},
			methods: {
				search() {

					if (this.currentPage != 1 && 10 == this.list.length) {
						console.log("没数据了")
						mui('#pullrefresh').pullRefresh().endPullupToRefresh(true);

					} else {
						//mui('#pullrefresh').pullRefresh().endPullupToRefresh(false);
						//mui('#pullrefresh').pullRefresh().endPulldownToRefresh();

						mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
						mui('#pullrefresh').pullRefresh().endPullupToRefresh(false);

					}
					if (this.currentPage == 1) {
						mui('#pullrefresh').pullRefresh().refresh(true);
					}
					if (this.currentPage == 1 && 10 <= 10) {
						console.log("没数据了")
						mui('#pullrefresh').pullRefresh().endPullupToRefresh(true);
					}
					this.isMove = false
				},
				moveHandel() {
					this.isMove = true;
					let that = this
					setTimeout(() => {
						that.isMove = false
					}, 1000)
				},
				gotobag(){
					location.href="bag.html"
				},
				gotome(){
				    location.href='personal.html'	
				},
				goDetail(item) {
					if (this.isMove) return
					location.href = "product.html?id=" + item.id;
				}
			}
		})



	}

	function pulldownRefresh() {
		setTimeout(function() {
			app.$data.currentPage = 1;
			app.search();
			console.log("=====================下拉刷新数据=============")
			//mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
		}, 1500);

	}

	function pullupRefresh() {
		setTimeout(function() {
			console.log("=================上啦拉去数据==================")
			//mui('#pullrefresh').pullRefresh().endPullupToRefresh((++count > 2)); //参数为true代表没有更多数据了。
			app.$data.currentPage = app.$data.currentPage + 1;
			app.search();
		}, 1500);

	}
</script>
